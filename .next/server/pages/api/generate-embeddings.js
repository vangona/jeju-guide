"use strict";(()=>{var e={};e.id=601,e.ids=[601],e.modules={1618:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var i=n(3480),s=n(8667),a=n(6435),o=n(2054),d=e([o]);o=(d.then?(await d)():d)[0];let c=(0,a.M)(o,"default"),l=(0,a.M)(o,"config"),u=new i.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/generate-embeddings",pathname:"/api/generate-embeddings",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},2054:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>d});var i=n(7984),s=n(6675),a=n.n(s),o=e([i]);if(i=(o.then?(await o)():o)[0],!a().apps.length){let e={projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")};a().initializeApp({credential:a().credential.cert(e)})}let c=a().firestore(),l=process.env.ADMIN_UIDS?process.env.ADMIN_UIDS.split(","):[];async function d(e,t){if(t.setHeader("Access-Control-Allow-Credentials",!0),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version"),"OPTIONS"===e.method)return void t.status(200).end();if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{userId:n}=e.body;if(!l.includes(n))return t.status(403).json({error:"Unauthorized: Admin access required"});let r=new i.default({apiKey:process.env.OPENAI_API_KEY}),s=await c.collection("places").get(),o=[];s.forEach(e=>{let t=e.data();o.push({id:e.id,...t})});let d=0;for(let e of o)try{if(e.embedding&&e.embedding.length>0)continue;let t=[e.name||"",e.description||"",e.addressDetail||e.address||"",e.type||""].filter(Boolean).join(" ");if(!t.trim())continue;let n=(await r.embeddings.create({model:"text-embedding-ada-002",input:t})).data[0].embedding;await c.collection("places").doc(e.id).update({embedding:n,embeddingText:t,embeddingUpdatedAt:a().firestore.FieldValue.serverTimestamp()}),d++,await new Promise(e=>setTimeout(e,100))}catch(t){console.error(`Error processing place ${e.id}:`,t);continue}t.status(200).json({success:!0,processedCount:d,totalPlaces:o.length,message:`Successfully generated embeddings for ${d} places`})}catch(e){console.error("Error generating embeddings:",e),t.status(500).json({error:"Failed to generate embeddings",details:e.message})}}r()}catch(e){r(e)}})},3480:(e,t,n)=>{e.exports=n(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},6675:e=>{e.exports=require("firebase-admin")},7984:e=>{e.exports=import("openai")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=1618);module.exports=n})();