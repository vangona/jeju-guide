"use strict";(()=>{var e={};e.id=723,e.ids=[723],e.modules={3480:(e,t,r)=>{e.exports=r(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6180:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(7984),i=r(6675),s=r.n(i),o=e([a]);if(a=(o.then?(await o)():o)[0],!s().apps.length){let e={projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")};s().initializeApp({credential:s().credential.cert(e)})}let d=s().firestore();async function c(e,t){if(t.setHeader("Access-Control-Allow-Credentials",!0),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version"),"OPTIONS"===e.method)return void t.status(200).end();if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{query:r,apiKey:n,limit:i=5}=e.body;if(!n)return t.status(400).json({error:"OpenAI API 키가 필요합니다."});let s=new a.default({apiKey:n});try{let e=(await s.embeddings.create({model:"text-embedding-ada-002",input:r})).data[0].embedding,n=await d.collection("places").where("embedding","!=",null).get(),a=(e,t)=>{let r=0,n=0,a=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i],n+=e[i]*e[i],a+=t[i]*t[i];return r/(Math.sqrt(n)*Math.sqrt(a))},o=[];n.forEach(t=>{let r=t.data();if(r.embedding&&Array.isArray(r.embedding)){let n=a(e,r.embedding);o.push({id:t.id,...r,similarity:n})}});let c=o.sort((e,t)=>t.similarity-e.similarity).slice(0,i).map(({similarity:e,embedding:t,...r})=>r);return t.status(200).json({success:!0,places:c})}catch(e){return console.error("Vector search error:",e),t.status(500).json({success:!1,error:"벡터 검색 중 오류가 발생했습니다."})}}n()}catch(e){n(e)}})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6675:e=>{e.exports=require("firebase-admin")},7898:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>u});var a=r(3480),i=r(8667),s=r(6435),o=r(6180),c=e([o]);o=(c.then?(await c)():c)[0];let d=(0,s.M)(o,"default"),l=(0,s.M)(o,"config"),u=new a.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/vector-search",pathname:"/api/vector-search",bundlePath:"",filename:""},userland:o});n()}catch(e){n(e)}})},7984:e=>{e.exports=import("openai")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7898);module.exports=r})();