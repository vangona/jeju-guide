(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{3386:(s,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>h});var c=a(7876),i=a(3576),n=a(4232),t=a(9099),l=a(1772),r=a(1041),d=a(8312),o=a(5665);let _=s=>{let{userObj:e}=s,a=(0,t.useRouter)(),[_,h]=(0,n.useState)(!1),[j,m]=(0,n.useState)({totalPlaces:0,recentPlaces:0,placesThisMonth:0}),[x,p]=(0,n.useState)([]),[N,u]=(0,n.useState)(!0),[v,g]=(0,n.useState)(!1),[f,b]=(0,n.useState)("idle"),[y,w]=(0,n.useState)("");(0,n.useEffect)(()=>{e||a.push("/auth")},[e,a]),(0,n.useEffect)(()=>{(async()=>{if(e)try{u(!0);let s=(0,o.P)((0,o.rJ)(d.C5,"places")),e=await (0,o.GG)(s),a=[];e.forEach(s=>{let e=s.data();a.push((0,i._)({id:s.id},e))});let c=new Date,n=new Date(c.getFullYear(),c.getMonth(),1),t=new Date(c.getTime()-6048e5),l=s=>{if(s.createdAt){if("object"==typeof s.createdAt&&s.createdAt.toDate)return s.createdAt.toDate();else if("number"==typeof s.createdAt)return new Date(s.createdAt)}return null},r=a.filter(s=>{let e=l(s);return!e||e>=n}).length,_=a.filter(s=>{let e=l(s);return!e||e>=t}).length;m({totalPlaces:a.length,recentPlaces:_,placesThisMonth:r}),p(a.slice(0,5))}catch(s){m({totalPlaces:0,recentPlaces:0,placesThisMonth:0}),p([])}finally{u(!1)}})()},[e]);let k=async()=>{g(!0),b("processing"),w("임베딩을 생성하고 있습니다...");try{let s=await fetch("/api/generate-embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:null==e?void 0:e.uid})}),a=await s.json();s.ok?(b("success"),w("성공적으로 ".concat(a.processedCount,"개 장소의 임베딩을 생성했습니다."))):(b("error"),w(a.error||"임베딩 생성에 실패했습니다."))}catch(s){b("error"),w("서버 오류가 발생했습니다.")}finally{g(!1),setTimeout(()=>{b("idle"),w("")},3e3)}};return e?(0,c.jsxs)("div",{className:"admin__page",children:[(0,c.jsxs)("div",{className:"admin__background",children:[(0,c.jsx)("div",{className:"admin__wave"}),(0,c.jsx)("div",{className:"admin__wave"}),(0,c.jsx)("div",{className:"admin__wave"})]}),(0,c.jsx)("header",{className:"admin__header",children:(0,c.jsxs)("div",{className:"admin__nav",children:[(0,c.jsxs)("button",{className:"nav-btn nav-btn--back",onClick:()=>{a.back()},children:[(0,c.jsx)(l.g,{icon:r.CeG}),(0,c.jsx)("span",{children:"뒤로"})]}),(0,c.jsxs)("div",{className:"admin__title-section",children:[(0,c.jsx)(l.g,{icon:r.dB,className:"title-icon"}),(0,c.jsx)("h1",{className:"admin__title",children:"관리자 대시보드"})]}),(0,c.jsxs)("div",{className:"admin__user-section",children:[(0,c.jsxs)("button",{className:"user-profile-btn",onClick:()=>{h(!_)},children:[(0,c.jsx)(l.g,{icon:r.X46}),(0,c.jsx)("span",{className:"user-name",children:e.displayName||"사용자"})]}),_&&(0,c.jsxs)("div",{className:"profile__dropdown",children:[(0,c.jsxs)("div",{className:"profile__info",children:[(0,c.jsx)("div",{className:"profile__avatar",children:e.photoURL?(0,c.jsx)("img",{src:e.photoURL,alt:"프로필"}):(0,c.jsx)(l.g,{icon:r.X46})}),(0,c.jsxs)("div",{className:"profile__details",children:[(0,c.jsx)("p",{className:"profile__name",children:e.displayName||"익명 사용자"}),(0,c.jsx)("p",{className:"profile__email",children:e.uid})]})]}),(0,c.jsxs)("div",{className:"profile__actions",children:[(0,c.jsxs)("button",{className:"profile__action",onClick:()=>{a.push("/")},children:[(0,c.jsx)(l.g,{icon:r.v02}),(0,c.jsx)("span",{children:"홈으로"})]}),(0,c.jsxs)("button",{className:"profile__action profile__action--logout",onClick:()=>{window.confirm("로그아웃 하시겠습니까?")&&(d.y1.signOut(),a.push("/"))},children:[(0,c.jsx)(l.g,{icon:r.GxD}),(0,c.jsx)("span",{children:"로그아웃"})]})]})]})]})]})}),(0,c.jsxs)("main",{className:"admin__content",children:[(0,c.jsx)("div",{className:"admin__welcome",children:(0,c.jsxs)("div",{className:"welcome__content",children:[(0,c.jsxs)("h2",{children:["안녕하세요, ",e.displayName||"사용자","님!"]}),(0,c.jsx)("p",{children:"제주 가이드 관리자 대시보드에 오신 것을 환영합니다."})]})}),(0,c.jsxs)("div",{className:"admin__stats",children:[(0,c.jsxs)("div",{className:"stats__card",children:[(0,c.jsx)("div",{className:"stats__icon",children:(0,c.jsx)(l.g,{icon:r.Pcr})}),(0,c.jsxs)("div",{className:"stats__content",children:[(0,c.jsx)("h3",{children:N?"...":j.totalPlaces}),(0,c.jsx)("p",{children:"총 등록 장소"})]})]}),(0,c.jsxs)("div",{className:"stats__card",children:[(0,c.jsx)("div",{className:"stats__icon",children:(0,c.jsx)(l.g,{icon:r.BEE})}),(0,c.jsxs)("div",{className:"stats__content",children:[(0,c.jsx)("h3",{children:N?"...":j.placesThisMonth}),(0,c.jsx)("p",{children:"이번 달 등록"})]})]}),(0,c.jsxs)("div",{className:"stats__card",children:[(0,c.jsx)("div",{className:"stats__icon",children:(0,c.jsx)(l.g,{icon:r.$Fj})}),(0,c.jsxs)("div",{className:"stats__content",children:[(0,c.jsx)("h3",{children:N?"...":j.recentPlaces}),(0,c.jsx)("p",{children:"최근 7일"})]})]})]}),(0,c.jsxs)("div",{className:"admin__actions",children:[(0,c.jsxs)("h3",{className:"section__title",children:[(0,c.jsx)(l.g,{icon:r.dB}),"빠른 작업"]}),(0,c.jsxs)("div",{className:"actions__grid",children:[(0,c.jsxs)("button",{className:"action__card action__card--primary",onClick:()=>{a.push("/post")},children:[(0,c.jsx)("div",{className:"action__icon",children:(0,c.jsx)(l.g,{icon:r.QLR})}),(0,c.jsxs)("div",{className:"action__content",children:[(0,c.jsx)("h4",{children:"새 장소 등록"}),(0,c.jsx)("p",{children:"새로운 장소를 등록하고 다른 여행자들과 공유해보세요"})]})]}),(0,c.jsxs)("button",{className:"action__card action__card--secondary",onClick:()=>{a.push("/edit")},children:[(0,c.jsx)("div",{className:"action__icon",children:(0,c.jsx)(l.g,{icon:r.MT7})}),(0,c.jsxs)("div",{className:"action__content",children:[(0,c.jsx)("h4",{children:"장소 관리"}),(0,c.jsx)("p",{children:"등록된 장소들을 수정하거나 삭제할 수 있습니다"})]})]}),(0,c.jsxs)("button",{className:"action__card action__card--vector",onClick:k,disabled:v,children:[(0,c.jsx)("div",{className:"action__icon",children:(0,c.jsx)(l.g,{icon:v?r.z1G:r.UBk,spin:v})}),(0,c.jsxs)("div",{className:"action__content",children:[(0,c.jsx)("h4",{children:"Vector Search 관리"}),(0,c.jsx)("p",{children:"AI 검색을 위한 임베딩을 생성합니다"}),y&&(0,c.jsxs)("div",{className:"vector-status vector-status--".concat(f),children:[(0,c.jsx)(l.g,{icon:"success"===f?r.SGM:"error"===f?r.zpE:r.z1G,spin:"processing"===f}),(0,c.jsx)("span",{children:y})]})]})]})]})]}),x.length>0&&(0,c.jsxs)("div",{className:"admin__recent",children:[(0,c.jsxs)("h3",{className:"section__title",children:[(0,c.jsx)(l.g,{icon:r.Pcr}),"최근 등록한 장소"]}),(0,c.jsx)("div",{className:"recent__list",children:x.map(s=>(0,c.jsxs)("div",{className:"recent__item",children:[(0,c.jsxs)("div",{className:"recent__info",children:[(0,c.jsx)("h4",{className:"recent__name",children:s.name}),(0,c.jsx)("span",{className:"recent__type",children:s.type}),(0,c.jsx)("p",{className:"recent__description",children:s.description.length>100?"".concat(s.description.slice(0,100),"..."):s.description})]}),(0,c.jsxs)("div",{className:"recent__meta",children:[s.attachmentUrlArray&&s.attachmentUrlArray.length>0&&(0,c.jsxs)("div",{className:"recent__badge",children:[(0,c.jsx)(l.g,{icon:r.Cyq}),(0,c.jsx)("span",{children:s.attachmentUrlArray.length})]}),s.url&&(0,c.jsx)("div",{className:"recent__badge",children:(0,c.jsx)(l.g,{icon:r.CQO})})]})]},s.id))})]})]}),_&&(0,c.jsx)("div",{className:"profile__backdrop",onClick:()=>h(!1)})]}):null};function h(s){let{userObj:e}=s;return(0,c.jsx)(_,{userObj:e})}},4768:(s,e,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return a(3386)}])},9099:(s,e,a)=>{s.exports=a(8253)}},s=>{var e=e=>s(s.s=e);s.O(0,[725,772,636,593,792],()=>e(4768)),_N_E=s.O()}]);